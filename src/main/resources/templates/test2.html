<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modal 예제</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsmpeg/0.1/jsmpg.js"></script>
  <style>
    #video-canvas {
        display: grid;
        grid-template-columns: repeat(3, 1fr); /* 한 행에 3개의 비디오 */
        gap: 10px;
    }
    #pagination-controls {
        margin-top: 20px;
        text-align: center;
    }
  </style>
  <link rel="stylesheet" href="test2.css">
</head>
<body>

<div id="video-canvas" style="width:700px"></div>
<div id="pagination-controls">
  <button id="prev-button">이전</button>
  <span id="page-info"></span>
  <button id="next-button">다음</button>
</div>

<!-- Modal 구조 -->
<div id="myModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>모달 제목</h2>
    <canvas id="video"></canvas>
  </div>
</div>

<script>
    // script.js
  // 모달 요소와 버튼을 가져옵니다
  const modal = document.getElementById("myModal");
  const span = document.getElementsByClassName("close")[0];

  // 모달 열기
  function clickModal() {
      modal.style.display = "block";
  }

  // 모달 닫기 (X 버튼 클릭 시)
  span.onclick = function() {
      modal.style.display = "none";
  }

  // 모달 닫기 (모달 외부 클릭 시)
  window.onclick = function(event) {
      if (event.target == modal) {
          modal.style.display = "none";
      }
  }

</script>
<script>
  // 스트림 정보 배열
  var streams = [
      { wsPort: 3001 }, { wsPort: 3002 }, { wsPort: 3003 }, { wsPort: 3004 },
      { wsPort: 3005 }, { wsPort: 3006 }, { wsPort: 3007 }, { wsPort: 3008 },
      { wsPort: 3009 }, { wsPort: 3010 }, { wsPort: 3011 }
  ];


  // 페이지네이션 설정
  let currentPage = 1;
  const itemsPerPage = 6; // 한 페이지에 표시할 cctv수
  const container = document.getElementById('video-canvas');

  // 현재 페이지의 cctv 스트림을 렌더링하는 함수
  function renderVideos() {
      container.innerHTML = ''; // 기존 비디오 제거

      // 시작 인덱스와 끝 인덱스 계산
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = startIndex + itemsPerPage;
      const currentItems = streams.slice(startIndex, endIndex);

      // 현재 페이지의 스트림을 렌더링
      currentItems.forEach(function (stream, index) {
          // 캔버스 동적 생성
          var canvas = document.createElement('canvas');
          canvas.id = 'canvas' + index;
          canvas.style.width = "200px";
          canvas.style.height = "200px";
          canvas.onclick= clickModal;
          container.appendChild(canvas);

          // WebSocket 연결 설정
          var client = new WebSocket('ws://localhost:' + stream.wsPort);

          // jsmpeg로 스트림을 캔버스에 렌더링
          var player = new jsmpeg(client, {
              canvas: canvas,
          });
      });

      // 페이지 정보 업데이트
      updatePageInfo();
  }

  // 페이지 정보 업데이트 함수
  function updatePageInfo() {
      const pageInfo = document.getElementById('page-info');
      const totalPages = Math.ceil(streams.length / itemsPerPage);
      pageInfo.textContent = `페이지 ${currentPage} / ${totalPages}`;
  }

  // 이전 페이지 버튼 클릭 핸들러
  document.getElementById('prev-button').addEventListener('click', () => {
      if (currentPage > 1) {
          currentPage--;
          renderVideos();
      }
  });

  // 다음 페이지 버튼 클릭 핸들러
  document.getElementById('next-button').addEventListener('click', () => {
      const totalPages = Math.ceil(streams.length / itemsPerPage);
      if (currentPage < totalPages) {
          currentPage++;
          renderVideos();
      }
  });

  // 초기 비디오 렌더링
  renderVideos();
</script>

</body>
</html>
