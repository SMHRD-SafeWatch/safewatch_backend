<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Client with Pagination</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsmpeg/0.1/jsmpg.js"></script>
    <style>
        #video-canvas {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 한 행에 3개의 비디오 */
            gap: 10px;
        }
        #pagination-controls {
            margin-top: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
<div id="video-canvas" style="width:700px"></div>
<div id="pagination-controls">
    <button id="prev-button">이전</button>
    <span id="page-info"></span>
    <button id="next-button">다음</button>
</div>
<script>
    // 데이터를 가져오는 함수
    async function fetchCameraData() {
      try {
        // API 요청
        const response = await fetch('http://localhost:8084/api/portget');
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }

        // JSON 데이터로 변환
        const cameras = await response.json();

        // 데이터를 HTML에 표시
        const cameraListDiv = document.getElementById('camera-list');
        cameras.forEach(camera => {
          const cameraDiv = document.createElement('div');
          cameraDiv.textContent = `Camera ID: ${camera.id}, Port: ${camera.wsPort}`;
          cameraListDiv.appendChild(cameraDiv);
        });
      } catch (error) {
        console.error('Error fetching camera data:', error);
      }
    }

    // 페이지가 로드되면 데이터 가져오기
    window.onload = fetchCameraData;
</script>
<script>
    // 스트림 정보 배열
    var streams = [
        { wsPort: 3001 }, { wsPort: 3002 }, { wsPort: 3003 }, { wsPort: 3004 },
        { wsPort: 3005 }, { wsPort: 3006 }, { wsPort: 3007 }, { wsPort: 3008 },
        { wsPort: 3009 }, { wsPort: 3010 }, { wsPort: 3011 }
    ];


    // 페이지네이션 설정
    let currentPage = 1;
    const itemsPerPage = 6; // 한 페이지에 표시할 cctv수
    const container = document.getElementById('video-canvas');

    // 현재 페이지의 cctv 스트림을 렌더링하는 함수
    function renderVideos() {
        container.innerHTML = ''; // 기존 비디오 제거

        // 시작 인덱스와 끝 인덱스 계산
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const currentItems = streams.slice(startIndex, endIndex);

        // 현재 페이지의 스트림을 렌더링
        currentItems.forEach(function (stream, index) {
            // 캔버스 동적 생성
            var canvas = document.createElement('canvas');
            canvas.id = 'canvas' + index;
            canvas.style.width = "200px";
            canvas.style.height = "200px";
            container.appendChild(canvas);

            // WebSocket 연결 설정
            var client = new WebSocket('ws://localhost:' + stream.wsPort);

            // jsmpeg로 스트림을 캔버스에 렌더링
            var player = new jsmpeg(client, {
                canvas: canvas,
            });
        });

        // 페이지 정보 업데이트
        updatePageInfo();
    }

    // 페이지 정보 업데이트 함수
    function updatePageInfo() {
        const pageInfo = document.getElementById('page-info');
        const totalPages = Math.ceil(streams.length / itemsPerPage);
        pageInfo.textContent = `페이지 ${currentPage} / ${totalPages}`;
    }

    // 이전 페이지 버튼 클릭 핸들러
    document.getElementById('prev-button').addEventListener('click', () => {
        if (currentPage > 1) {
            currentPage--;
            renderVideos();
        }
    });

    // 다음 페이지 버튼 클릭 핸들러
    document.getElementById('next-button').addEventListener('click', () => {
        const totalPages = Math.ceil(streams.length / itemsPerPage);
        if (currentPage < totalPages) {
            currentPage++;
            renderVideos();
        }
    });

    // 초기 비디오 렌더링
    renderVideos();
</script>
</body>
</html>
